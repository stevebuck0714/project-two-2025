<div class="client-banker-line">
    <div class="banker-info">
        <div class="client-info">
            <span class="client-full" id="client-full-display">Client: </span>
        </div>
        <div class="banker-details">
            <% if (typeof user !== 'undefined' && user && user.type === 'banker') { %>
                <span class="banker-label">Private Banker:</span>
                <span class="banker-name" id="private-banker-name"><%= user.name %></span>
            <% } else if (typeof user !== 'undefined' && user && user.type === 'client') { %>
                <span class="banker-label">Private Banker:</span>
                <span class="banker-name" id="private-banker-name"><%= user.banker || 'Not Assigned' %></span>
            <% } else { %>
                <span class="banker-label">Private Banker:</span>
                <span class="banker-name" id="private-banker-name">Not Logged In</span>
            <% } %>
        </div>
    </div>
</div>

<style>
.client-banker-line {
    background-color: #007bff;
    border-bottom: 1px solid #0056b3;
    padding: 0;
    width: 100%;
    min-width: 100vw;
    margin: 0;
    box-sizing: border-box;
}

.banker-info {
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
    max-width: calc(1500px + 2px) !important;
    margin: 0 auto !important;
    width: 100% !important;
    padding: 0.5rem calc(2rem + 1px) !important;
    box-sizing: border-box !important;
}

.client-info {
    display: flex !important;
    align-items: center !important;
    white-space: nowrap !important;
    flex: 0 0 auto !important;
    margin-right: auto !important;
}

.banker-details {
    display: flex !important;
    align-items: center !important;
    gap: 0.5rem !important;
    flex: 0 0 auto !important;
    margin-left: auto !important;
}

.client-full, .banker-label {
    font-weight: 600;
    color: white;
    display: inline;
}

.banker-name {
    color: white;
    font-weight: 500;
    display: inline;
}
</style>

<script>
// Server-side user data (if available)
const serverUser = <% if (typeof user !== 'undefined' && user) { %><%- JSON.stringify(user) %><% } else { %>null<% } %>;

// This script populates the client name in the header
document.addEventListener('DOMContentLoaded', function() {
    const clientFullElement = document.getElementById('client-full-display');
    const clientInfoDiv = document.querySelector('.client-info');
    const currentPath = window.location.pathname;
    
    if (clientFullElement) {
        // Priority 1: If user is logged in as a client, show their name
        if (serverUser && serverUser.type === 'client') {
            clientFullElement.textContent = 'Client: ' + serverUser.name;
            clientInfoDiv.style.display = 'flex';
        }
        // Priority 2: If user is a banker and has selected a client, show selected client
        else if (serverUser && serverUser.type === 'banker') {
            // Clear localStorage if we're on the home page (client selection page)
            if (currentPath === '/') {
                // Don't show any client on the home page until one is selected
                clientInfoDiv.style.display = 'none';
            }
            // Don't show client name on Client Alerts page
            else if (currentPath === '/client-alerts') {
                clientInfoDiv.style.display = 'none';
            } else {
                const selectedClient = localStorage.getItem('selectedClient');
                if (selectedClient) {
                    // Extract just the name part before the hyphen
                    const clientName = selectedClient.split(' - ')[0].trim();
                    clientFullElement.textContent = 'Client: ' + clientName;
                    clientInfoDiv.style.display = 'flex';
                } else {
                    clientInfoDiv.style.display = 'none';
                }
            }
        }
        // Priority 3: Fallback to localStorage for backward compatibility
        else {
            const clientName = localStorage.getItem('clientName');
            if (clientName) {
                clientFullElement.textContent = 'Client: ' + clientName;
                clientInfoDiv.style.display = 'flex';
            } else {
                clientInfoDiv.style.display = 'none';
            }
        }
    }
});
</script> 