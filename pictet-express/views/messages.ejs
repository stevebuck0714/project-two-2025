<%- include('partials/header') %>
<%- include('partials/secondary-nav') %>

<div class="stability-message">
    <h2>Messages</h2>
</div>

<style>
/* Remove rounded corners and darker borders */
.messages-section,
.message-item {
    border-radius: 0 !important;
    border-color: #999 !important;
}
</style>

<div class="main-container">
    
    <div class="messages-container">
        <div class="message-tabs">
            <button class="message-tab active" onclick="showMessageTab('inbox')">Inbox</button>
            <button class="message-tab" onclick="showMessageTab('sent')">Sent Messages</button>
        </div>
        
        <div class="messages-section" id="inbox-section">
            <div class="message-list">
                <% if (typeof user !== 'undefined' && user && user.type === 'banker') { %>
                    <!-- Messages for Banker/Advisor -->
                    <div class="message-item unread">
                        <div class="message-header">
                            <h3>From: John Smith - Secondary Position Inquiry</h3>
                            <span class="date">Today, 10:30</span>
                        </div>
                        <p class="preview">Hi <%= user.name %>, I'm interested in acquiring a secondary position in UBS ASSET MANAGEMENT SPV 2. Can you provide details on the current NAV, DPI, and remaining commitment obligations?...</p>
                    </div>
                    <div class="message-item important">
                        <div class="message-header">
                            <h3>From: Marie Dubois - List PE Investment for Sale</h3>
                            <span class="date">Yesterday, 15:45</span>
                        </div>
                        <p class="preview">I would like to list my UBS Asset Management Real Estate Fund position for sale on the bulletin board. Could you help me with the pricing and listing process?...</p>
                    </div>
                    <div class="message-item unread">
                        <div class="message-header">
                            <h3>From: Hans Weber - Nordic Healthcare Growth Fund V Interest</h3>
                            <span class="date">Yesterday, 09:20</span>
                        </div>
                        <p class="preview">I noticed the Nordic Healthcare Growth Fund V in the Available PE Investments section. Given my mandate focus on healthcare, I'd like to discuss a €350K commitment...</p>
                    </div>
                    <div class="message-item">
                        <div class="message-header">
                            <h3>From: Sofia Rossi - Co-Investment Opportunity Questions</h3>
                            <span class="date">2 days ago</span>
                        </div>
                        <p class="preview">Can we discuss the co-investment opportunity in the European Software Secondary Portfolio? I need more details on the underlying companies and fee structure...</p>
                    </div>
                <% } else { %>
                    <!-- Messages for Client -->
                    <div class="message-item unread">
                        <div class="message-header">
                            <h3>From: <%= (typeof user !== 'undefined' && user && user.banker) ? user.banker : 'Your Advisor' %> - Secondary Market Match Found</h3>
                            <span class="date">Today, 10:30</span>
                        </div>
                        <p class="preview">Good news! A secondary position matching your investment criteria has become available: UBS ASSET MANAGEMENT SPV 3 (Infrastructure). Current DPI 0.92x, €900K remaining commitment...</p>
                    </div>
                    <div class="message-item important">
                        <div class="message-header">
                            <h3>From: <%= (typeof user !== 'undefined' && user && user.banker) ? user.banker : 'Your Advisor' %> - New PE Investment Opportunity</h3>
                            <span class="date">Yesterday, 15:45</span>
                        </div>
                        <p class="preview">Nordic Healthcare Growth Fund V is now available for commitment. This aligns perfectly with your healthcare sector mandate. €400M target size, 2%/20% fees, GP track record shows 19.5% IRR...</p>
                    </div>
                    <div class="message-item">
                        <div class="message-header">
                            <h3>From: <%= (typeof user !== 'undefined' && user && user.banker) ? user.banker : 'Your Advisor' %> - Listing Confirmation</h3>
                            <span class="date">2 days ago</span>
                        </div>
                        <p class="preview">Your UBS Asset Management Infrastructure Fund II position has been successfully listed on the bulletin board. We've already received two inquiries from interested buyers...</p>
                    </div>
                <% } %>
            </div>
        </div>
        
        <div class="messages-section" id="sent-section" style="display: none;">
            <div class="message-list">
                <% if (typeof user !== 'undefined' && user && user.type === 'banker') { %>
                    <!-- Sent Messages for Banker/Advisor -->
                    <div class="message-item sent">
                        <div class="message-header">
                            <h3>To: John Smith - Secondary Position Details</h3>
                            <span class="date">Today, 14:23</span>
                        </div>
                        <p class="preview">Hi John, Regarding UBS ASSET MANAGEMENT SPV 2: Current NAV is €6.2M, DPI of 0.85x, total called €3.8M with €700K remaining commitment. The fund has performed well with strong exits expected in 2025. Let's discuss pricing...</p>
                        <div class="message-details">
                            <span class="recipient">Sent to: john.smith@email.com</span>
                            <span class="status">✓ Delivered</span>
                        </div>
                    </div>
                    <div class="message-item sent">
                        <div class="message-header">
                            <h3>To: Marie Dubois - Listing Your PE Position</h3>
                            <span class="date">2 days ago</span>
                        </div>
                        <p class="preview">Hello Marie, I've prepared the documentation to list your Real Estate Fund position on the bulletin board. Based on current NAV and market conditions, I recommend pricing at 95% of NAV. Attached is the term sheet for your review...</p>
                        <div class="message-details">
                            <span class="recipient">Sent to: marie.dubois@email.com</span>
                            <span class="status">✓ Read</span>
                        </div>
                    </div>
                    <div class="message-item sent">
                        <div class="message-header">
                            <h3>To: Hans Weber - Nordic Healthcare Growth Fund V Diligence Pack</h3>
                            <span class="date">1 week ago</span>
                        </div>
                        <p class="preview">Hans, Attached is the complete diligence pack for Nordic Healthcare Growth Fund V. Key highlights: proven digitization thesis, 3 successful telehealth exits, strong LP base. The €350K commitment fits perfectly within your mandate. Let's schedule a call...</p>
                        <div class="message-details">
                            <span class="recipient">Sent to: hans.weber@email.com</span>
                            <span class="status">✓ Read</span>
                        </div>
                    </div>
                <% } else { %>
                    <!-- Sent Messages for Client -->
                    <div class="message-item sent">
                        <div class="message-header">
                            <h3>To: <%= (typeof user !== 'undefined' && user && user.banker) ? user.banker : 'My Advisor' %> - UBS ASSET MANAGEMENT SPV 1 Secondary Interest</h3>
                            <span class="date">Today, 14:23</span>
                        </div>
                        <p class="preview">Hi, I'm interested in acquiring the UBS ASSET MANAGEMENT SPV 1 secondary position listed on the bulletin board. Can you provide more details on the underlying portfolio companies, vintage diversification, and expected J-curve trajectory?...</p>
                        <div class="message-details">
                            <span class="recipient">Sent to advisor</span>
                            <span class="status">✓ Delivered</span>
                        </div>
                    </div>
                    <div class="message-item sent">
                        <div class="message-header">
                            <h3>To: <%= (typeof user !== 'undefined' && user && user.banker) ? user.banker : 'My Advisor' %> - List PE Investment for Sale</h3>
                            <span class="date">2 days ago</span>
                        </div>
                        <p class="preview">Hello, I'd like to list my UBS Asset Management Infrastructure Fund position on the bulletin board to create liquidity for a new healthcare opportunity. What's the process and timeline for listing? Can you help with pricing guidance?...</p>
                        <div class="message-details">
                            <span class="recipient">Sent to advisor</span>
                            <span class="status">✓ Read</span>
                        </div>
                    </div>
                    <div class="message-item sent">
                        <div class="message-header">
                            <h3>To: <%= (typeof user !== 'undefined' && user && user.banker) ? user.banker : 'My Advisor' %> - European Software Secondary Portfolio Questions</h3>
                            <span class="date">1 week ago</span>
                        </div>
                        <p class="preview">Hi, I'm considering the European Software Secondary Portfolio from the Available PE Investments. Can we discuss the underlying assets, expected hold period, and how this fits with my existing tech exposure? I'm thinking €300K commitment...</p>
                        <div class="message-details">
                            <span class="recipient">Sent to advisor</span>
                            <span class="status">✓ Read</span>
                        </div>
                    </div>
                <% } %>
            </div>
        </div>
    </div>
</div>

<style>
.message-tabs {
    display: flex;
    border-bottom: 2px solid #e0e6ed;
    margin-bottom: 0.75rem;
    gap: 0;
}

.message-tab {
    padding: 0.5rem 1.25rem;
    border: none;
    background: transparent;
    font-size: 0.95rem;
    font-weight: 500;
    color: #666;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.2s;
}

.message-tab.active {
    color: #e60012;
    border-bottom-color: #e60012;
    background: #f8fafc;
}

.message-tab:hover {
    color: #e60012;
    background: #f8fafc;
}

.message-item.sent {
    border-left: 4px solid #28a745;
    background: #f8fff9;
}

.message-details {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 0.35rem;
    font-size: 0.8rem;
    color: #666;
}

.recipient {
    font-weight: 500;
}

.status {
    color: #28a745;
    font-weight: 500;
}

.messages-section {
    min-height: auto;
}
</style>

<script>
function showMessageTab(tabName) {
    // Hide all sections
    document.getElementById('inbox-section').style.display = 'none';
    document.getElementById('sent-section').style.display = 'none';
    
    // Remove active class from all tabs
    document.querySelectorAll('.message-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Show selected section and activate tab
    if (tabName === 'inbox') {
        document.getElementById('inbox-section').style.display = 'block';
        document.querySelector('.message-tab[onclick*="inbox"]').classList.add('active');
    } else if (tabName === 'sent') {
        document.getElementById('sent-section').style.display = 'block';
        document.querySelector('.message-tab[onclick*="sent"]').classList.add('active');
    }
}
</script>

<%- include('partials/footer') %> 