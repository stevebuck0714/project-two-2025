<%- include('partials/header') %>
<%- include('partials/secondary-nav') %>

<div class="stability-message" style="display: flex; justify-content: space-between; align-items: center;">
    <h2>Your Private Markets & Wealth Briefing</h2>
    <a href="/contact-advisor?type=generic" class="btn btn-generic">Contact My Advisor</a>
</div>

<div class="briefing-container">


        <!-- Section 1: Today at a Glance -->
        <div class="briefing-section">
            <h3>Today at a Glance</h3>
            <div class="glance-grid">
                <!-- Row 1 -->
                <div class="glance-item portfolio-card">
                    <div class="portfolio-nav-section">
                        <div class="nav-metric">
                            <span class="nav-label">PE Portfolio NAV</span>
                            <span class="nav-value">‚Ç¨<%= privateAssetsNAV.toLocaleString('de-DE') %></span>
                        </div>
                    </div>
                    <div class="performance-section">
                        <div class="performance-header">PE Strategy Distribution</div>
                        <div class="performance-metrics">
                            <% peStrategies.forEach(strategy => { %>
                            <div class="metric-row">
                                <span class="period"><%= strategy.name %></span>
                                <span class="change neutral"><%= strategy.percentage %>%</span>
                            </div>
                            <% }); %>
                        </div>
                    </div>
                </div>

                <div class="glance-item liquidity-card">
                    <div class="card-header">
                        <h4>Liquidity Forecast</h4>
                        <div class="period-label">Next 90 Days</div>
                    </div>
                    <div class="liquidity-summary">
                        <div class="net-position">
                            <span class="label">Net Position</span>
                            <span class="amount negative">-‚Ç¨<%= (upcomingCapitalCalls - expectedDistributions).toLocaleString() %></span>
                        </div>
                        <div class="breakdown">
                            <div class="breakdown-item">
                                <span class="type">Capital Calls</span>
                                <span class="amount">‚Ç¨<%= upcomingCapitalCalls.toLocaleString() %></span>
                            </div>
                            <div class="breakdown-item">
                                <span class="type">Distributions</span>
                                <span class="amount">‚Ç¨<%= expectedDistributions.toLocaleString() %></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glance-item actions-card">
                    <div class="card-header">
                        <h4>Quick Actions</h4>
                    </div>
                    <div class="action-grid">
                        <a href="/transactions" class="action-item">
                            <div class="action-icon">üí∞</div>
                            <span class="action-text">Fund Capital Call</span>
                        </a>
                        <a href="#" class="action-item">
                            <div class="action-icon">üìä</div>
                            <span class="action-text">Download Statement</span>
                        </a>
                        <a href="/messages" class="action-item">
                            <div class="action-icon">üí¨</div>
                            <span class="action-text">Message Banker</span>
                        </a>
                        <a href="/portfolio-summary" class="action-item">
                            <div class="action-icon">üìà</div>
                            <span class="action-text">View Portfolio</span>
                        </a>
                    </div>
                </div>

                <!-- Row 2 -->
                <div class="glance-item market-indexes-card">
                    <div class="card-header">
                        <h4>New Secondary Market Listings</h4>
                        <div class="period-label">Last 2 Weeks</div>
                    </div>
                    <div class="index-list">
                        <div class="index-item">
                            <span class="index-name">European Buyout Fund VII</span>
                            <div>
                                <span class="index-value">‚Ç¨4.2M</span>
                                <span class="index-change neutral">3 days ago</span>
                            </div>
                        </div>
                        <div class="index-item">
                            <span class="index-name">Tech Growth Fund III</span>
                            <div>
                                <span class="index-value">‚Ç¨2.8M</span>
                                <span class="index-change neutral">5 days ago</span>
                            </div>
                        </div>
                        <div class="index-item">
                            <span class="index-name">Infrastructure Partners II</span>
                            <div>
                                <span class="index-value">‚Ç¨6.5M</span>
                                <span class="index-change neutral">7 days ago</span>
                            </div>
                        </div>
                        <div class="index-item">
                            <span class="index-name">Healthcare Ventures IV</span>
                            <div>
                                <span class="index-value">‚Ç¨3.1M</span>
                                <span class="index-change neutral">10 days ago</span>
                            </div>
                        </div>
                        <div class="index-item">
                            <span class="index-name">Real Estate Fund VIII</span>
                            <div>
                                <span class="index-value">‚Ç¨5.7M</span>
                                <span class="index-change neutral">12 days ago</span>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; text-align: center; border-top: 1px solid #f0f0f0; padding-top: 0.75rem;">
                        <a href="/investment-opportunities?tab=secondary" style="color: #003f5c; text-decoration: none; font-weight: 600; font-size: 0.9rem;">View All Secondary Market Opportunities ‚Üí</a>
                    </div>
                </div>

                <div class="glance-item rebalancing-card">
                    <div class="card-header">
                        <h4>Portfolio Rebalancing</h4>
                        <div class="period-label">Target vs Current</div>
                    </div>
                    <div class="rebalancing-list" id="rebalancing-list">
                        <div class="rebalancing-placeholder">
                            <p style="text-align: center; color: #999; padding: 20px;">Set target allocations in the Portfolio page to see rebalancing recommendations</p>
                        </div>
                    </div>
                </div>

                <script>
                // Calculate and display portfolio rebalancing needs
                document.addEventListener('DOMContentLoaded', function() {
                    const rebalancingList = document.getElementById('rebalancing-list');
                    
                    // Portfolio data matching server-side
                    const totalPortfolioValue = 20000000;
                    const currentAllocations = {
                        'Cash': 5.00,
                        'Marketable Securities': 45.3125,
                        'Fixed Income': 15.00,
                        'Private Funds': 16.25,
                        'Hedge Funds': 6.9375,
                        'Other Assets': 11.5
                    };
                    
                    // Get saved target allocations from localStorage
                    const savedTargets = localStorage.getItem('portfolioTargetAllocations');
                    
                    if (savedTargets) {
                        const targetAllocations = JSON.parse(savedTargets);
                        let hasChanges = false;
                        let rebalancingHTML = '';
                        
                        // Calculate differences for each asset type
                        Object.keys(currentAllocations).forEach(assetType => {
                            const current = currentAllocations[assetType];
                            const target = targetAllocations[assetType];
                            
                            if (target !== undefined && Math.abs(target - current) > 0.01) {
                                hasChanges = true;
                                const difference = target - current;
                                const dollarAmount = (difference / 100) * totalPortfolioValue;
                                const action = difference > 0 ? 'Buy' : 'Sell';
                                const changeClass = difference > 0 ? 'positive' : 'negative';
                                
                                rebalancingHTML += `
                                    <div class="rebalancing-item">
                                        <span class="rebalancing-asset">${assetType}</span>
                                        <div>
                                            <span class="rebalancing-action ${changeClass}">${action} ‚Ç¨${Math.abs(dollarAmount).toLocaleString('de-DE')}</span>
                                        </div>
                                    </div>
                                `;
                            }
                        });
                        
                        if (hasChanges) {
                            rebalancingList.innerHTML = rebalancingHTML;
                        } else {
                            rebalancingList.innerHTML = '<div class="rebalancing-placeholder"><p style="text-align: center; color: #28a745; padding: 20px;">‚úì Portfolio is aligned with targets</p></div>';
                        }
                    }
                });
                </script>

                <style>
                .rebalancing-card {
                    background: white;
                    padding: 1rem 1.5rem 1.5rem 1.5rem;
                    border-radius: 8px;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                }

                .rebalancing-list {
                    display: flex;
                    flex-direction: column;
                    gap: 0.75rem;
                }

                .rebalancing-item {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 0.35rem 0;
                    border-bottom: 1px solid #f0f0f0;
                }

                .rebalancing-item:last-child {
                    border-bottom: none;
                }

                .rebalancing-asset {
                    font-weight: 600;
                    color: #333;
                    font-size: 0.95rem;
                }

                .rebalancing-action {
                    font-weight: 600;
                    font-size: 0.9rem;
                }

                .rebalancing-action.positive {
                    color: #16a085;
                }

                .rebalancing-action.negative {
                    color: #e74c3c;
                }

                .rebalancing-placeholder p {
                    margin: 0;
                    font-size: 0.9rem;
                }
                </style>

                <div class="glance-item market-card">
                    <div class="card-header">
                        <h4>Market Environment</h4>
                        <div class="regime-indicator <%= macroRegime.toLowerCase() %>"><%= macroRegime %></div>
                    </div>
                    <div class="market-indicators">
                        <div class="indicator-row">
                            <span class="indicator-label">Volatility</span>
                            <span class="indicator-value <%= volatility.toLowerCase() %>"><%= volatility %></span>
                        </div>
                        <div class="indicator-row">
                            <span class="indicator-label">Credit Spreads</span>
                            <span class="indicator-value <%= creditSpreads.toLowerCase() %>"><%= creditSpreads %></span>
                        </div>
                        <div class="indicator-row">
                            <span class="indicator-label">PE Multiples</span>
                            <span class="indicator-value elevated">Elevated</span>
                        </div>
                        <div class="indicator-row">
                            <span class="indicator-label">Exit Activity</span>
                            <span class="indicator-value improving">Improving</span>
                        </div>
                        <div class="indicator-row">
                            <span class="indicator-label">Dry Powder</span>
                            <span class="indicator-value high">High</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <!-- Section 3: Macro Snapshot -->
    <div class="briefing-section">
        <h3>Macro Snapshot</h3>
        <div class="macro-grid">
            <div class="macro-item">
                <strong>Rates:</strong> Policy rate unchanged; futures imply 50 bps cuts in next 12 months.
            </div>
            <div class="macro-item">
                <strong>Growth:</strong> Leading indicators stabilizing, <strong>Inflation:</strong> moderating, <strong>Labor:</strong> cooling but resilient.
            </div>
            <div class="macro-item">
                <strong>Markets:</strong> Public equity breadth improving, HY spreads tightening, USD trend neutral.
            </div>
        </div>
        <div class="macro-implication">
            <strong>Implication for private markets:</strong> pacing outlook positive, entry multiples stabilizing, exit windows opening in H2.
        </div>
        <a href="#" class="btn-secondary">See the 3-minute house view</a>
    </div>

    <!-- Section 4: Your Portfolio Signals -->
    <div class="briefing-section">
        <h3>Your Portfolio Signals</h3>
        <div class="portfolio-heatmap">
            <div class="heatmap-header">
                <div class="heatmap-title">Strategy Performance Overview</div>
            </div>
            <div class="heatmap-grid">
                <div class="heatmap-row header">
                    <div class="heatmap-cell">Strategy</div>
                    <div class="heatmap-cell">Committed</div>
                    <div class="heatmap-cell">DPI</div>
                    <div class="heatmap-cell">TVPI</div>
                    <div class="heatmap-cell">IRR</div>
                    <div class="heatmap-cell">Pace vs Plan</div>
                </div>
                <div class="heatmap-row">
                    <div class="heatmap-cell">Buyout</div>
                    <div class="heatmap-cell">‚Ç¨2.1M</div>
                    <div class="heatmap-cell">1.4x</div>
                    <div class="heatmap-cell">2.1x</div>
                    <div class="heatmap-cell">18.2%</div>
                    <div class="heatmap-cell positive">+5%</div>
                </div>
                <div class="heatmap-row">
                    <div class="heatmap-cell">Growth</div>
                    <div class="heatmap-cell">‚Ç¨1.8M</div>
                    <div class="heatmap-cell">0.8x</div>
                    <div class="heatmap-cell">1.9x</div>
                    <div class="heatmap-cell">22.5%</div>
                    <div class="heatmap-cell negative">-15%</div>
                </div>
                <div class="heatmap-row">
                    <div class="heatmap-cell">Private Credit</div>
                    <div class="heatmap-cell">‚Ç¨1.2M</div>
                    <div class="heatmap-cell">1.1x</div>
                    <div class="heatmap-cell">1.3x</div>
                    <div class="heatmap-cell">12.8%</div>
                    <div class="heatmap-cell neutral">0%</div>
                </div>
            </div>
        </div>
        <div class="watchlist-alerts">
            <h4>Watchlist Alerts</h4>
            <div class="alert-item warning">
                <span class="alert-icon">‚ö†Ô∏è</span>
                <strong>European Growth Fund II</strong> pacing 15% below plan ‚Äî consider co-invests or secondary purchases.
            </div>
            <div class="alert-item info">
                <span class="alert-icon">üìà</span>
                <strong>Healthcare Buyout Fund IV</strong> distribution wave likely in Q2 from portfolio exits in medtech sector.
            </div>
            <div class="alert-item attention">
                <span class="alert-icon">üîç</span>
                <strong>Direct Lending Fund III</strong> yield drift vs benchmark > +150 bps (check risk bands).
            </div>
        </div>
        <a href="/portfolio-summary" class="btn-primary">Open Portfolio Diagnostics</a>
    </div>


    <!-- Section 6: Cash flows & Liquidity -->
    <div class="briefing-section">
        <h3>Upcoming Cash Flows & Liquidity</h3>
        <div class="cashflow-timeline">
            <div class="timeline-header">Next 30/60/90 days:</div>
            <div class="cashflow-grid">
                <div class="cashflow-item">
                    <span class="cashflow-label">Capital Calls:</span>
                    <span class="cashflow-value">‚Ç¨350,000</span>
                </div>
                <div class="cashflow-item">
                    <span class="cashflow-label">Projected Distributions:</span>
                    <span class="cashflow-value">‚Ç¨180,000</span>
                </div>
                <div class="cashflow-item">
                    <span class="cashflow-label">Net:</span>
                    <span class="cashflow-value negative">-‚Ç¨170,000</span>
                </div>
            </div>
        </div>
        <div class="coverage-info">
            <div class="coverage-grid">
                <div class="coverage-item">
                    <span class="coverage-label">Available cash:</span>
                    <span class="coverage-value">‚Ç¨425,000</span>
                </div>
                <div class="coverage-item">
                    <span class="coverage-label">Credit facility headroom:</span>
                    <span class="coverage-value">‚Ç¨200,000</span>
                </div>
                <div class="coverage-item">
                    <span class="coverage-label">Cushion:</span>
                    <span class="coverage-value">8 months</span>
                </div>
            </div>
        </div>
        <div class="cashflow-actions">
            <button class="btn-primary">Set Auto-Sweep Rules</button>
            <button class="btn-secondary">Download Cash Plan (PDF)</button>
        </div>
    </div>

    <!-- Section 7: Banker's Notes -->
    <div class="briefing-section">
        <h3>Banker's Notes & Documents</h3>
        <div class="banker-notes">
            <h4>From your team:</h4>
            <div class="note-item">
                <span class="note-icon">üíº</span>
                <p>"Quarterly pacing check ready. Suggest allocating ‚Ç¨400K to secondaries in Q4 to smooth J-curve."</p>
            </div>
            <div class="note-item">
                <span class="note-icon">üìÑ</span>
                <p>"Updated DDQ for Nordic Healthcare Growth Fund uploaded."</p>
            </div>
        </div>
        <div class="document-links">
            <a href="#" class="doc-link">Latest DDQ</a>
            <a href="#" class="doc-link">Subscription docs</a>
            <a href="#" class="doc-link">K-1 / Tax package</a>
        </div>
        <button class="btn-primary">Secure message your banker</button>
    </div>

    <!-- Section 9: Education -->
    <div class="briefing-section">
        <h3>Education</h3>
        <div class="education-items">
            <h4>2-min explainers:</h4>
            <div class="education-item">
                <h5>Secondaries vs. NAV Lending‚Äîwhat changes your DPI path</h5>
                <span class="education-time">2 min read</span>
            </div>
            <div class="education-item">
                <h5>How to read a capital call schedule</h5>
                <span class="education-time">2 min read</span>
            </div>
            <div class="education-item">
                <h5>Co-invest diligence checklist (what to ask in 10 minutes)</h5>
                <span class="education-time">2 min read</span>
            </div>
        </div>
    </div>
</div>

<!-- Sticky Footer -->
<div class="briefing-footer">
    <div class="footer-links">
        <a href="#">Disclosures</a>
        <a href="#">Methodology</a>
        <a href="#">Data sources</a>
        <a href="#">Update preferences</a>
        <a href="#">Accessibility</a>
    </div>
    <div class="footer-tagline">
        Today's signal, not noise. ‚Ä¢ In plain English: here's what it means for your portfolio. ‚Ä¢ Matched to your mandate‚Äîno spray and pray.
    </div>
</div>

<%- include('partials/footer') %>
