<%- include('partials/header') %>
<%- include('partials/secondary-nav') %>

<style>
/* Ultra-compact Strategy Selection Section */
.strategy-columns {
    gap: 4px !important;
    margin-bottom: 4px !important;
}
.strategy-category-container {
    padding: 4px !important;
}
.strategy-category-header {
    margin-bottom: 2px !important;
    padding-bottom: 2px !important;
    font-size: 1.05rem !important;
}
.strategy-list {
    gap: 2px !important;
}
.strategy-option {
    padding: 4px !important;
    margin-bottom: 2px !important;
}
.strategy-header {
    gap: 0.25rem !important;
}
.strategy-name {
    font-size: 1rem !important;
}
.strategy-description {
    margin: 0.1rem 0 !important;
    font-size: 0.85rem !important;
}
.selection-counter {
    margin-top: 2px !important;
    font-size: 0.85rem !important;
}
</style>

<div class="main-container">
    <div class="container">
        <!-- Navigation Tabs -->
        <div class="builder-tabs mb-4">
            <a href="#investment-calculator" class="builder-tab active">Investment Calculator</a>
        </div>

        <!-- Content Sections -->
        <div class="portfolio-builder-content">

            <!-- Investment Calculator Section (Combined Income Goal + Investment Capacity) -->
            <section id="investment-calculator" class="builder-section active">
                <div style="display: flex; gap: 2rem; max-width: 1400px; margin: 0 auto;">
                    <!-- Income Goal Calculator Container -->
                    <div class="income-goal-container calculator-option" id="income-goal-calc" style="flex: 1; padding: 1.5rem 2rem 2rem 2rem; background: linear-gradient(135deg, #f8fafc 60%, #e3e6f3 100%); border-radius: 12px; box-shadow: 0 4px 16px rgba(44,62,80,0.08); border: 3px solid #3498db; cursor: pointer;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 1rem;">
                            <input type="radio" name="calculator-type" id="income-goal-radio" value="income-goal" checked style="margin: 0;">
                            <h2 style="margin: 0; font-size: 2rem; font-weight: 700; color: #8B0000; letter-spacing: 0.5px;">Income Goal Calculator</h2>
                        </div>
                        <p style="margin-bottom: 1.1rem; font-size: 1.05rem; color: #444;">Calculate investment required to meet specific income targets</p>
                        <div style="margin-bottom: 1.3rem; font-size: 0.95rem; color: #333;">
                            <strong>Answer the core question:</strong> "I need €X income for Y years starting in Z years - how much do I invest now?"
                        </div>
                        <form>
                            <div style="margin-bottom: 1.1rem;">
                                <label for="initial-investment" style="font-size: 1rem; font-weight: 600; color: #2d3748;">Initial Investment</label>
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.2rem;">
                                    <span style="font-size: 1.1rem; font-weight: bold; color: #8B0000;">€</span>
                                    <input id="initial-investment" type="text" class="form-control income-goal-input" value="1,000,000" style="width: 30%; padding: 0.5rem 0.6rem; font-size: 1rem; border: 1.5px solid #bfc9d9; border-radius: 6px; background: #fafdff;" />
                                </div>
                                <small style="color: #888;">Available capital to invest now</small>
                            </div>
                            <div style="margin-bottom: 1.1rem;">
                                <label for="annual-distribution" style="font-size: 1rem; font-weight: 600; color: #2d3748;">Required Annual Distribution</label>
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.2rem;">
                                    <span style="font-size: 1.1rem; font-weight: bold; color: #8B0000;">€</span>
                                    <input id="annual-distribution" type="text" class="form-control income-goal-input" value="400,000" style="width: 30%; padding: 0.5rem 0.6rem; font-size: 1rem; border: 1.5px solid #bfc9d9; border-radius: 6px; background: #fafdff;" />
                                </div>
                                <small style="color: #888;">Annual income distribution required</small>
                            </div>
                            <div style="display: flex; gap: 1rem; margin-bottom: 1.1rem;">
                                <div style="flex: 1;">
                                    <label for="investment-period" style="font-size: 1rem; font-weight: 600; color: #2d3748;">Investment Period</label>
                                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.2rem;">
                                        <input id="investment-period" type="number" class="form-control" value="10" style="width: 80px; padding: 0.5rem 0.6rem; font-size: 1rem; border: 1.5px solid #bfc9d9; border-radius: 6px; background: #fafdff;" />
                                        <span style="font-size: 1rem;">years</span>
                                    </div>
                                    <small style="color: #888;">Investment accumulation period</small>
                                </div>
                                <div style="flex: 1;">
                                    <label for="income-start" style="font-size: 1rem; font-weight: 600; color: #2d3748;">Income Start</label>
                                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.2rem;">
                                        <input id="income-start" type="number" class="form-control" value="10" style="width: 80px; padding: 0.5rem 0.6rem; font-size: 1rem; border: 1.5px solid #bfc9d9; border-radius: 6px; background: #fafdff;" />
                                        <span style="font-size: 1rem;">years</span>
                                    </div>
                                    <small style="color: #888;">When income generation begins</small>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Investment Capacity Calculator Container -->
                    <div class="investment-capacity-container calculator-option" id="investment-capacity-calc" style="flex: 1; padding: 1.5rem 2rem 2rem 2rem; background: linear-gradient(135deg, #f8fafc 60%, #e3e6f3 100%); border-radius: 12px; box-shadow: 0 4px 16px rgba(44,62,80,0.08); border: 3px solid #ccc; opacity: 0.6; cursor: pointer;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 1rem;">
                            <input type="radio" name="calculator-type" id="investment-capacity-radio" value="investment-capacity" style="margin: 0;">
                            <h2 style="margin: 0; font-size: 2rem; font-weight: 700; color: #8B0000; letter-spacing: 0.5px;">Investment Capacity Calculator</h2>
                        </div>
                        <p style="margin-bottom: 1.1rem; font-size: 1.05rem; color: #444;">Calculate income potential from available investment capacity</p>
                        <div style="margin-bottom: 1.3rem; font-size: 0.95rem; color: #333;">
                            <strong>Answer the core question:</strong> "I can invest €X now + €Y/month for Z years - how much income can I generate?"
                        </div>
                        <form>
                            <div style="margin-bottom: 1.1rem;">
                                <label for="ic-initial-investment" style="font-size: 1rem; font-weight: 600; color: #2d3748;">Initial Investment</label>
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.2rem;">
                                    <span style="font-size: 1.1rem; font-weight: bold; color: #8B0000;">€</span>
                                    <input id="ic-initial-investment" name="ic-initial-investment" type="number" placeholder="1,000,000" style="width: 30%; padding: 0.5rem 0.6rem; font-size: 1rem; border: 1.5px solid #bfc9d9; border-radius: 6px; background: #fafdff;" />
                                </div>
                                <small style="color: #888;">Available capital to invest now</small>
                            </div>
                            <div style="margin-bottom: 1.1rem;">
                                <label for="ic-monthly-addition" style="font-size: 1rem; font-weight: 600; color: #2d3748;">Monthly Addition</label>
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.2rem;">
                                    <span style="font-size: 1.1rem; font-weight: bold; color: #8B0000;">€</span>
                                    <input id="ic-monthly-addition" name="ic-monthly-addition" type="number" placeholder="25,000" style="width: 30%; padding: 0.5rem 0.6rem; font-size: 1rem; border: 1.5px solid #bfc9d9; border-radius: 6px; background: #fafdff;" />
                                </div>
                                <small style="color: #888;">Monthly investment capacity (optional)</small>
                            </div>
                            <div style="display: flex; gap: 1rem; margin-bottom: 1.1rem;">
                                <div style="flex: 1;">
                                    <label for="ic-investment-period" style="font-size: 1rem; font-weight: 600; color: #2d3748;">Investment Period</label>
                                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.2rem;">
                                        <input id="ic-investment-period" name="ic-investment-period" type="number" placeholder="10" style="width: 80px; padding: 0.5rem 0.6rem; font-size: 1rem; border: 1.5px solid #bfc9d9; border-radius: 6px; background: #fafdff;" />
                                        <span style="font-size: 1rem;">years</span>
                                    </div>
                                    <small style="color: #888;">Investment accumulation period</small>
                                </div>
                                <div style="flex: 1;">
                                    <label for="ic-income-start" style="font-size: 1rem; font-weight: 600; color: #2d3748;">Income Start</label>
                                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.2rem;">
                                        <input id="ic-income-start" name="ic-income-start" type="number" placeholder="10" style="width: 80px; padding: 0.5rem 0.6rem; font-size: 1rem; border: 1.5px solid #bfc9d9; border-radius: 6px; background: #fafdff;" />
                                        <span style="font-size: 1rem;">years</span>
                                    </div>
                                    <small style="color: #888;">When income generation begins</small>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </section>

            <!-- Commitment Criteria Section -->
            <section id="commitment" class="builder-section">
                <div class="commitment-criteria-container" style="max-width: 600px; margin: 0 auto; padding: 2rem; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                    <h2 style="margin-bottom: 2rem;">Commitment Criteria</h2>
                    <h3>Income Goal Calculator</h3>
                    <p style="margin-bottom: 1rem;">Calculate investment required to meet specific income targets</p>
                    <h3>Return by Investment Capacity Calculator</h3>
                    <p style="margin-bottom: 2rem;">Calculate income potential from available investment capacity</p>
                    <div style="margin-bottom: 2rem;">
                        <strong>Answer the core question:</strong> "I need €X income for Y years starting in Z years - how much do I invest now?"
                    </div>
                    <form>
                        <div style="margin-bottom: 1.5rem;">
                            <label for="annual-income" style="display: block; font-weight: 500;">Annual Income Needed</label>
                            <input id="annual-income" name="annual-income" type="number" placeholder="€500,000" style="width: 100%; padding: 0.5rem; margin-top: 0.25rem; border: 1px solid #ccc; border-radius: 4px;" />
                            <small style="color: #888;">After-tax annual income requirement</small>
                        </div>
                        <div style="margin-bottom: 1.5rem;">
                            <label for="duration" style="display: block; font-weight: 500;">Duration</label>
                            <input id="duration" name="duration" type="number" placeholder="15" style="width: 100%; padding: 0.5rem; margin-top: 0.25rem; border: 1px solid #ccc; border-radius: 4px;" />
                            <small style="color: #888;">How long income is needed (years)</small>
                        </div>
                        <div style="margin-bottom: 2rem;">
                            <label for="start-in" style="display: block; font-weight: 500;">Start In</label>
                            <input id="start-in" name="start-in" type="number" placeholder="10" style="width: 100%; padding: 0.5rem; margin-top: 0.25rem; border: 1px solid #ccc; border-radius: 4px;" />
                            <small style="color: #888;">Years until income starts</small>
                        </div>
                        <button type="submit" style="background: #e31e24; color: #fff; border: none; padding: 0.75rem 2rem; border-radius: 4px; font-size: 1rem; font-weight: bold; cursor: pointer;">Calculate</button>
                    </form>
                </div>
            </section>

            <!-- Build Portfolio Section -->
            <section id="build-portfolio" class="builder-section">
                <!-- Content will be added here -->
            </section>
        </div>
    </div>
</div>

<!-- Include the JavaScript file -->
<script src="/js/portfolio-builder.js"></script>

<script>
// Calculator selection functionality
document.addEventListener('DOMContentLoaded', function() {
    const incomeGoalCalc = document.getElementById('income-goal-calc');
    const investmentCapacityCalc = document.getElementById('investment-capacity-calc');
    const incomeGoalRadio = document.getElementById('income-goal-radio');
    const investmentCapacityRadio = document.getElementById('investment-capacity-radio');
    
    function updateCalculatorSelection() {
        if (incomeGoalRadio.checked) {
            // Activate Income Goal Calculator
            incomeGoalCalc.style.border = '3px solid #3498db';
            incomeGoalCalc.style.opacity = '1';
            
            // Deactivate Investment Capacity Calculator
            investmentCapacityCalc.style.border = '3px solid #ccc';
            investmentCapacityCalc.style.opacity = '0.6';
            
            // Enable/disable form inputs
            const incomeGoalInputs = incomeGoalCalc.querySelectorAll('input[type="number"], input[type="text"]');
            const capacityInputs = investmentCapacityCalc.querySelectorAll('input[type="number"]');
            
            incomeGoalInputs.forEach(input => input.disabled = false);
            capacityInputs.forEach(input => input.disabled = true);
            
        } else if (investmentCapacityRadio.checked) {
            // Activate Investment Capacity Calculator
            investmentCapacityCalc.style.border = '3px solid #3498db';
            investmentCapacityCalc.style.opacity = '1';
            
            // Deactivate Income Goal Calculator
            incomeGoalCalc.style.border = '3px solid #ccc';
            incomeGoalCalc.style.opacity = '0.6';
            
            // Enable/disable form inputs
            const incomeGoalInputs = incomeGoalCalc.querySelectorAll('input[type="number"], input[type="text"]');
            const capacityInputs = investmentCapacityCalc.querySelectorAll('input[type="number"]');
            
            incomeGoalInputs.forEach(input => input.disabled = true);
            capacityInputs.forEach(input => input.disabled = false);
        }
    }
    
    // Add click handlers for the entire containers
    incomeGoalCalc.addEventListener('click', function() {
        incomeGoalRadio.checked = true;
        updateCalculatorSelection();
    });
    
    investmentCapacityCalc.addEventListener('click', function() {
        investmentCapacityRadio.checked = true;
        updateCalculatorSelection();
    });
    
    // Add change handlers for radio buttons
    incomeGoalRadio.addEventListener('change', updateCalculatorSelection);
    investmentCapacityRadio.addEventListener('change', updateCalculatorSelection);
    
    // Initialize the selection state
    updateCalculatorSelection();
    
    // Comma formatting for Income Goal Calculator inputs
    function formatNumberWithCommas(value) {
        // Remove all non-digit characters
        const numericValue = value.replace(/[^\d]/g, '');
        // Add commas
        return numericValue.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }
    
    function handleCommaInput(event) {
        const input = event.target;
        const cursorPosition = input.selectionStart;
        const oldValue = input.value;
        const newValue = formatNumberWithCommas(oldValue);
        
        input.value = newValue;
        
        // Adjust cursor position for added/removed commas
        const commasBefore = (oldValue.substring(0, cursorPosition).match(/,/g) || []).length;
        const commasAfter = (newValue.substring(0, cursorPosition).match(/,/g) || []).length;
        const newCursorPosition = cursorPosition + (commasAfter - commasBefore);
        
        input.setSelectionRange(newCursorPosition, newCursorPosition);
    }
    
    // Add event listeners to Income Goal calculator inputs
    const incomeGoalInputs = document.querySelectorAll('.income-goal-input');
    incomeGoalInputs.forEach(input => {
        input.addEventListener('input', handleCommaInput);
        input.addEventListener('paste', function(e) {
            setTimeout(() => handleCommaInput(e), 0);
        });
    });
    
    // Update Build Portfolio button to check which calculator is selected
    const buildPortfolioBtn = document.getElementById('build-portfolio-btn');
    if (buildPortfolioBtn) {
        buildPortfolioBtn.addEventListener('click', function() {
            const selectedCalculator = document.querySelector('input[name="calculator-type"]:checked');
            if (selectedCalculator) {
                console.log('Building portfolio using:', selectedCalculator.value);
                // Add your portfolio building logic here based on the selected calculator
                if (selectedCalculator.value === 'income-goal') {
                    console.log('Using Income Goal Calculator values');
                    // Use values from income goal form
                } else if (selectedCalculator.value === 'investment-capacity') {
                    console.log('Using Investment Capacity Calculator values');
                    // Use values from investment capacity form
                }
            }
        });
    }
});
</script>

<%- include('partials/footer') %> 